(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/component/comment"],{"3e6a":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c},m=[];n.d(e,"a",function(){return o}),n.d(e,"b",function(){return m})},"6c52":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=m(n("cc4f"));function m(t){return t&&t.__esModule?t:{default:t}}var i=function(){return n.e("graceUI/components/graceDialog").then(n.bind(null,"15df"))},s={name:"comment",components:{graceDialog:i},data:function(){return{previewImageUrl:"",customTheme:"",userId:"",type:"",item_id:"",article_id:"",reqParams:"",zoomImg:"",modalName:null,commentList:[],showOptionDialog:!1,optionIndex:"",uploadMark:"",commentImg:[],commentContent:"",commentIndex:"",focus:!1,placeholder:"说点什么吧 ..."}},onLoad:function(t){this.customTheme=this.$store.state.customTheme,console.log(t.id,t.type," at pages\\component\\comment.vue:118"),this.userId=this.$store.state.userInfo.userId,this.type=t.type,1==t.type?(this.item_id=1*t.id,this.reqParams={item_id:this.item_id},this.commentGetbyitemid(t,"/item/"+this.item_id+"/comments")):2==t.type&&(this.article_id=1*t.id,this.reqParams={article_id:this.article_id},this.commentGetbyitemid(t,"/article/"+this.article_id+"/comments"))},onReady:function(){console.log(this.$store.state.userInfo," at pages\\component\\comment.vue:137")},methods:{commentGetbyitemid:function(t,e){var n=this;this.$http({url:e}).then(function(t){n.commentList=t.reverse()})},zoomImgSet:function(t,e){var n=this.commentList[t].comment_img_url[e];this.zoomImg="background-image: url(".concat(n,")"),console.log(this.zoomImg," at pages\\component\\comment.vue:150")},showModal:function(t){console.log(t," at pages\\component\\comment.vue:153"),this.modalName=t.currentTarget.dataset.target},hideModal:function(t){this.modalName=null},thumb:function(t,e){var n=this,o=e?"DELETE":"POST";this.$http({url:"/thumb",method:o,data:{comment_id:this.commentList[t].comment_id},loading:"none"}).then(function(o){n.commentList[t].status=!e,n.commentList[t].thumb_up_count+=e?-1:1})},comment:function(t,e){this.commentIndex=[t,0,"","",e],this.placeholder="回复 ".concat(this.commentList[t].user.nickname),this.focus=!0},subComment:function(t,e,n,o,m){var i=this;this.commentIndex=[t,e,n,o,m],setTimeout(function(){console.log(i.commentIndex," at pages\\component\\comment.vue:184")},10),this.placeholder="回复 ".concat(o),this.focus=!0},blur:function(){var t=this;this.placeholder="说点什么吧 ...",this.focus=!1,setTimeout(function(){t.commentIndex=""},1500)},imgUpload:function(){var e=this;t.chooseImage({success:function(n){var m=n.tempFilePaths;t.showLoading({title:"图片上传中"}),console.log(1,m[0]," at pages\\component\\comment.vue:203"),t.compressImage({src:m[0],quality:80,success:function(n){t.uploadFile({url:o.default+"/user/upload",filePath:n.tempFilePath,header:{token:e.$store.state.token},name:"file",formData:{user_id:e.userId},success:function(n){var o=n.data;o.errorCode?t.showToast({title:o.msg,icon:"none"}):(e.commentImg[0]=JSON.parse(n.data).url,e.uploadMark="color:red",t.hideLoading())},fail:function(e){t.showToast({title:"上传失败",icon:"none"})}})}})}})},submitComments:function(){this.commentContent||this.commentImg[0]?(this.focus=!1,this.commentIndex.length?this.subCommentAdd():this.commentAdd()):t.showToast({title:"评论不能为空",icon:"none"})},commentAdd:function(){var e=this;this.reqParams.comment_detail=this.commentContent,this.reqParams.comment_img_url=this.commentImg,this.$http({url:"/comment",method:"POST",data:this.reqParams,laoding:"发送中"}).then(function(n){e.commentList.unshift({comment_id:n.comment_id,comment_img_url:e.commentImg,comment_detail:e.commentContent,user_id:e.userId,create_time:n.create_time,thumb_up_count:0,user:{nickname:e.$store.state.userInfo.nickName,avatar_url:e.$store.state.userInfo.avatarUrl},sub_comments:[],status:!1}),t.pageScrollTo({scrollTop:0,duration:300}),e.commentImg=[],e.uploadMark="",e.commentContent=""})},subCommentAdd:function(){var t=this;this.$http({url:"/sub_comment",method:"POST",data:{comment_id:this.commentIndex[4],sub_comment_detail:this.commentContent,to_user_id:this.commentIndex[2]?this.commentIndex[2]:""},loading:"发送中"}).then(function(e){t.commentList[t.commentIndex[0]].sub_comments.push({sub_comment_id:e.sub_comment_id,sub_comment_detail:t.commentContent,from_user_id:t.userId,to_user_id:t.commentIndex[2]?t.commentIndex[2]:"",create_time:e.create_time,from_user:{user_id:t.userId,nickname:t.$store.state.userInfo.nickName},to_user:{user_id:t.commentIndex[2]?t.commentIndex[2]:"",nickname:t.commentIndex[2]?t.commentIndex[3]:"",avatar_url:null,institution_id:null}}),t.commentContent=""})},subCommentDelete:function(t,e){var n=this;this.$http({url:"/sub_comment/"+this.commentList[t].sub_comments[e].sub_comment_id,method:"DELETE",loading:"删除中"}).then(function(o){n.commentList[t].sub_comments.splice(e,1)})},optionDialog:function(t){this.optionIndex=t,this.showOptionDialog=!0},closeOptionDialog:function(){this.showOptionDialog=!1},commentDelete:function(){var t=this;this.$http({url:"/comment/"+this.commentList[this.optionIndex].comment_id,method:"DELETE",loading:"删除中"}).then(function(e){t.commentList.splice(t.optionIndex,1),t.closeOptionDialog()})},previewImage:function(e){this.previewImageUrl=e,console.log(e," at pages\\component\\comment.vue:349"),t.previewImage({urls:[this.previewImageUrl],longPressActions:{itemList:["发送给朋友","保存图片","收藏"]}})}}};e.default=s}).call(this,n("6e42")["default"])},"711b":function(t,e,n){},"9a13":function(t,e,n){"use strict";n.r(e);var o=n("6c52"),m=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e["default"]=m.a},d81e:function(t,e,n){"use strict";var o=n("711b"),m=n.n(o);m.a},e663:function(t,e,n){"use strict";n.r(e);var o=n("3e6a"),m=n("9a13");for(var i in m)"default"!==i&&function(t){n.d(e,t,function(){return m[t]})}(i);n("d81e");var s=n("2877"),c=Object(s["a"])(m["default"],o["a"],o["b"],!1,null,"8b5aeb56",null);e["default"]=c.exports}},[["870c","common/runtime","common/vendor"]]]);