(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/parent-child-card"],{"0f5b":function(t,e,i){},"2a9b":function(t,e,i){"use strict";(function(t){i("1f93"),i("921b");n(i("66fd"));var e=n(i("aee5"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},"3e08":function(t,e,i){"use strict";var n=i("0f5b"),o=i.n(n);o.a},8124:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.form.price.split(".")),n=t.form.price.split("."),o=t.__map(t.giftList,function(e,i){var n=e.price.split(".");return{$orig:t.__get_orig(e),g2:n}});t.$mp.data=Object.assign({},{$root:{g0:i,g1:n,l0:o}})},o=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},a6ea:function(t,e,i){"use strict";i.r(e);var n=i("fd8e"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=o.a},aee5:function(t,e,i){"use strict";i.r(e);var n=i("8124"),o=i("a6ea");for(var a in o)"default"!==a&&function(t){i.d(e,t,function(){return o[t]})}(a);i("3e08");var r=i("2877"),s=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,null,null);e["default"]=s.exports},fd8e:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=function(){return Promise.all([i.e("common/vendor"),i.e("pages/component/wm-poster")]).then(i.bind(null,"1367"))},a=function(){return i.e("graceUI/components/graceDialog").then(i.bind(null,"15df"))},r=1;Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1};var s={components:{graceDialog:a,wmPoster:o},watch:{"$store.state.customTheme":function(t){this.customTheme=t}},data:function(){return{videoAutoPlay:!1,isVideoActive:1,videoTabCurrentIndex:0,videoSwiperCurrentIndex:0,clientHeight:"",activity_id:"",previewImageUrl:"",customTheme:"",ifPosterInfo:!0,tempFilePath:"",userInfo:"",tempTarget:"",posterImg:"",form:{thumb_up_count:""},deadline:[0,0,0,0],modalName:null,authorityDialog:null,giftList:[],titleShowId:"tabTag-0",show4:!1,tabCurrentIndex:0,swiperCurrentIndex:0,activeHeight:"height: auto",contentHeight:[],institutionList:[],tabs:[{name:"活动介绍",id:1},{name:"机构信息",id:3}],favoriteActive:!1,likeAmount:0,onLoadParams:"",extra:"",buildinParams:"",page:1}},onLoad:function(t){this.customTheme="pink",console.log("buildin params are",t),this.activity_id=t.id,this.onLoadParams=t},onShow:function(){},beforeDestroy:function(){this.likeAmount&&this.$http({url:"/activity/".concat(this.activity_id,"/up/").concat(this.likeAmount),v2:!0,method:"PUT",loading:"none"})},onReady:function(){var t=this,e=this.onLoadParams;e.scene?setTimeout(function(){e.scene=decodeURIComponent(e.scene),t.activity_id=e.scene.split("&")[0],t.$store.commit("extra",e.scene),setTimeout(function(){t.isScene(e)})},1e3):this.isScene(e)},onShareAppMessage:function(t){return{title:this.form.name,path:"pages/activity/parent-child-card?id="+this.activity_id,imageUrl:this.form.cover_img_url}},methods:{scrolltoRight:function(){r&&(r=0,this.getInstitutionInfo(),setTimeout(function(){r=1},1e3))},videoTabSelect:function(t){this.videoAutoPlay||(this.videoAutoPlay=!0),this.isVideoActive=0,this.isVideoActive=1;var e=t.currentTarget.dataset.id;this.videoSwiperCurrentIndex=e,this.videoTabCurrentIndex=e;var i=this.institutionList[e];i.video_url&&i.video_url.split("/page/")[1]&&(i.video_url=i.video_url.split("/page/")[1].split(".html")[0],this.getVideoInfo(i.video_url,e))},isScene:function(t){this.itemGetbyid(t),this.$store.state.userInfo.nickName&&(this.userInfo=this.$store.state.userInfo.nickName)},hideModal:function(t){this.ifPosterInfo=!1,this.modalName=null,this.tempFilePath=""},cancelSignIn:function(t){this.authorityDialog=null},authorize:function(){var e=this,i=this.onLoadParams;t.login({provider:"weixin",success:function(n){t.getUserInfo({provider:"weixin",success:function(o){e.$http({url:"/user/login",method:"POST",data:{code:n.code,nickname:o.userInfo.nickName,avatar_url:o.userInfo.avatarUrl},loading:"none"}).then(function(n){e.$store.commit("userInfo",o.userInfo),e.$store.commit("token",n.token),t.reLaunch({url:"./parent-child-card?id="+(i.id?i.id:i.scene.split("&")[0])})})}})}})},itemGetbyid:function(t){var e=this;this.$http({url:"/activity/"+(t.id?t.id:t.scene.split("&")[0])}).then(function(t){t.detail=t.detail.replace(/\<img/gi,'<img style="width:100%;height:auto" '),console.log(t,233333),e.form=t,e.$store.commit("posterSrc",e.form.cover_img_url),e.$store.commit("qrSrc",e.form.cover_img_url),setInterval(function(){n(e.form.end_date+864e5)},1e3);var i=e;function n(t){var e=new Date(1*t),n=new Date,o=parseInt((e-n)/1e3),a=Math.floor(o/86400),r=o%86400,s=Math.floor(r/3600);r%=3600;var u=Math.floor(r/60),c=r%60;i.deadline=[a,s,u,c]}e.getInstitutionInfo(),e.$http({url:"/activity/".concat(e.activity_id,"/gifts/",1),alert:"none"}).then(function(t){e.giftList=t})})},tabChange:function(t){var e=1*t.target.id.replace("tabTag-","");this.swiperCurrentIndex=e,this.tabCurrentIndex=e,this.titleShowId="tabTag-"+e},swiperChange:function(t){var e=t.detail.current;this.tabCurrentIndex=e,this.titleShowId="tabTag-"+e,this.institutionList.length||this.getInstitutionInfo()},jumpToSelect:function(){this.$store.state.userInfo.nickName?(this.$store.state.temp=this.form.max_items,t.navigateTo({url:"./component/pageList?id="+this.activity_id})):this.authorityDialog="DialogModal2"},pay:function(){function e(e){t.requestPayment({provider:"wxpay",timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(e){t.showToast({title:"支付成功",icon:"success"})}})}var i=this.$store.state.extra?{item_id:this.form.item_id,extra:this.$store.state.extra.split("&")[1]}:{item_id:this.form.item_id};this.buildinParams.order_id?this.$http({url:"/order/"+this.buildinParams.order_id,method:"PUT"}).then(function(t){e(t)}):this.$http({url:"/order",method:"POST",data:i,loading:"none"}).then(function(t){e(t)})},share:function(e){var i=this;this.deadline[0]<0?t.showModal({title:"提示",content:"活动已结束",showCancel:!1,confirmText:"知道了"}):(this.ifPosterInfo=!0,this.$http({url:"/activity/".concat(this.activity_id,"/share"),method:"POST",v2:!0,loading:"none"}).then(function(n){i.extra=n.extra,i.$store.commit("qrSrc",n.url),i.tempTarget=e.currentTarget.dataset.target,i.modalName=i.tempTarget,i.$refs.child.OnCanvas(),setTimeout(function(){t.showLoading({title:"海报生成中",mask:!0})},100)}))},getPosterInfo:function(t){this.tempFilePath=t.tempFilePath},hideLoading:function(){t.hideLoading()},save:function(){var e=this;t.saveImageToPhotosAlbum({filePath:this.tempFilePath,success:function(){e.hideModal(),t.showToast({title:"海报已保存到相册，可分享给好友",icon:"none",duration:2500})}})},shareTo:function(){var e=this;setTimeout(function(){t.previewImage({urls:[e.tempFilePath],longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(t){},fail:function(t){}}})})},favorite:function(){var t=this;this.favoriteActive||(this.form.thumb_up_count+=1,this.favoriteActive=!0,setTimeout(function(){t.favoriteActive=!1,t.likeAmount+=1},2e3))},getVideoInfo:function(t,e){var i=this,o="https://vv.video.qq.com/getinfo?otype=json&appver=3.2.19.333&platform=11&defnpayver=1&vid="+t;wx.request({url:o,success:function(o){var a=o.data.replace(/QZOutputJson=/,"")+"qwe",r=a.replace(/;qwe/,""),s=JSON.parse(r);console.log(s);var u=s.vl.vi[0].lnk;n=s["vl"]["vi"][0]["ul"]["ui"][0]["url"];var c=s["fl"]["fi"],l=s["vl"]["vi"][0]["cl"]["fc"];if(0==parseInt(l)&&(l=1),c.length>2)for(var d=c[c.length-1]["id"],h=1;h<l+1;h++){var f=u+".p"+d%1e4+"."+h+".mp4";i.requestVideoUrls(d,t,f,e)}else for(var m=c[c.length-1]["id"],v=1;v<l+1;v++){var p=u+".mp4";i.requestVideoUrls(m,t,p,e)}}})},requestVideoUrls:function(t,e,i,o){var a="https://vv.video.qq.com/getkey?otype=json&platform=11&format="+t+"&vid="+e+"&filename="+i+"&appver=3.2.19.333",r=this;wx.request({url:a,success:function(t){var e=t.data.replace(/QZOutputJson=/,"")+"qwe",a=e.replace(/;qwe/,""),s=JSON.parse(a);if(console.log(s),void 0!=s.key){var u=s["key"],c=n+i+"?vkey="+u;console.log(String(c),n),r.institutionList[o].video_url=String(c)}}})},getInstitutionInfo:function(){var e=this;this.$http({url:"/activity/".concat(this.activity_id,"/institutions/").concat(this.page),loading:"none"}).then(function(i){if(e.page<2){e.institutionList=i;var n=e.institutionList[0];n.video_url&&n.video_url.split("/page/")[1]&&(n.video_url=n.video_url.split("/page/")[1].split(".html")[0],e.getVideoInfo(n.video_url,0))}else{var o=!0,a=!1,r=void 0;try{for(var s,u=i[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;e.institutionList.push(c)}}catch(d){a=!0,r=d}finally{try{o||null==u.return||u.return()}finally{if(a)throw r}}}e.page+=1;var l=e;t.getSystemInfo({success:function(t){l.clientHeight=t.windowHeight}})})},scrolltoBottom:function(t){r&&(r=0,this.getInstitutionInfo(),setTimeout(function(){r=1},1e3))},home:function(){t.reLaunch({url:"../index/index"})},cancelAuth:function(){this.authorityDialog=null},previewImage:function(e){this.previewImageUrl=e,t.previewImage({urls:[this.previewImageUrl],longPressActions:{itemList:["发送给朋友","保存图片","收藏"]}})}}};e.default=s}).call(this,i("543d")["default"])}},[["2a9b","common/runtime","common/vendor"]]]);