(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/item"],{"3c0c":function(t,e,i){"use strict";i.r(e);var n=i("cc80"),o=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=o.a},7923:function(t,e,i){"use strict";(function(t){i("1f93"),i("921b");n(i("66fd"));var e=n(i("da71"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},8943:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=(t._self._c,new Date(t.form.start_date+288e5).toJSON().substr(0,10).replace("T"," ").replace(/-/g,"-")),n=new Date(t.form.end_date+288e5).toJSON().substr(0,10).replace("T"," ").replace(/-/g,"-"),o=t.__map(t.teachers,function(e,i){var n=e.teacher_title.toString(),o=e.teacher_title.toString(),a=e.teacher_title.toString().substr(0,12);return{$orig:t.__get_orig(e),g2:n,g3:o,g4:a}});t.$mp.data=Object.assign({},{$root:{g0:i,g1:n,l0:o}})},o=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return o})},"9bcb":function(t,e,i){},b442:function(t,e,i){"use strict";var n=i("9bcb"),o=i.n(n);o.a},cc80:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){return Promise.all([i.e("common/vendor"),i.e("pages/component/wm-poster")]).then(i.bind(null,"1367"))},o=function(){return i.e("graceUI/components/graceDialog").then(i.bind(null,"15df"))};Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1};var a={components:{graceDialog:o,wmPoster:n},watch:{"$store.state.customTheme":function(t){this.customTheme=t}},data:function(){return{previewImageUrl:"",customTheme:"",ifPosterInfo:!0,tempFilePath:"",userInfo:"",tempTarget:"",posterImg:"",form:"",modalName:null,authorityDialog:null,payFormDialog:null,payForm:{username:"",phone:"",item_id:""},isSaveAsDefault:!1,teachers:[],titleShowId:"tabTag-0",show4:!1,tabCurrentIndex:0,swiperCurrentIndex:0,activeHeight:"height: auto",contentHeight:[],institutionInfo:"",tabs:[{name:"项目介绍",id:1}],favoriteActive:"",onLoadParams:"",extra:"",buildinParams:""}},onLoad:function(t){this.buildinParams=t,console.log("buildin params are",t),this.customTheme=this.$store.state.customTheme,this.onLoadParams=t},onShow:function(){},onReady:function(){var t=this,e=this.onLoadParams;e.scene?setTimeout(function(){e.scene=decodeURIComponent(e.scene),t.$store.commit("extra",e.scene),setTimeout(function(){t.isScene(e)})},1e3):this.isScene(e)},onShareAppMessage:function(t){return t.from,{title:this.form.name,path:"pages/home/item?id="+this.form.item_id,imageUrl:this.tempFilePath}},methods:{isScene:function(t){this.itemGetbyid(t),this.$store.state.userInfo.nickName&&(this.userInfo=this.$store.state.userInfo.nickName)},hideModal:function(t){this.ifPosterInfo=!1,this.modalName=null,this.tempFilePath=""},cancelSignIn:function(){this.authorityDialog=null},authorize:function(){var e=this,i=this.onLoadParams;t.login({provider:"weixin",success:function(n){t.getUserInfo({provider:"weixin",success:function(o){e.$http({url:"/user/login",method:"POST",data:{code:n.code,nickname:o.userInfo.nickName,avatar_url:o.userInfo.avatarUrl},loading:"none"}).then(function(n){e.$store.commit("userInfo",o.userInfo),e.$store.commit("token",n.token),t.reLaunch({url:"./item?id="+(i.id?i.id:i.scene.split("&")[0])})})}})}})},itemGetbyid:function(t){var e=this;this.$http({url:"/item/"+(t.id?t.id:t.scene.split("&")[0])}).then(function(t){t.detail=t.detail.replace(/\<img/gi,'<img style="width:100%;height:auto" '),e.form=t,e.form.isCollected&&(e.favoriteActive="color: palevioletred"),e.$store.commit("posterSrc",e.form.img_url),e.$store.commit("qrSrc",e.form.img_url);for(var i="",n=0;n<e.form.teachers.length;n++)i+="&teacherIds["+n+"]="+e.form.teachers[n];e.$http({url:"/teachers?"+i.substr(1)}).then(function(t){e.teachers=t})})},tabChange:function(t){var e=1*t.target.id.replace("tabTag-","");this.swiperCurrentIndex=e,this.tabCurrentIndex=e,this.titleShowId="tabTag-"+e},swiperChange:function(t){var e=t.detail.current;this.tabCurrentIndex=e,this.titleShowId="tabTag-"+e,this.institutionInfo||this.getInstitutionInfo()},teacherJump:function(e){this.$store.commit("temp",this.teachers[e]),t.navigateTo({url:"./teacher"})},HidePayFormInput:function(){this.payFormDialog=null},payFormInput:function(){var e=this;this.$store.state.userInfo.nickName?(this.isSaveAsDefault=t.getStorageSync("payForm"),this.isSaveAsDefault?this.$http({url:"/user/identity",loading:"none"}).then(function(t){e.payForm.username=t.username,e.payForm.phone=t.phone,e.payFormDialog="payFormDialog"}):this.$http({url:"/user/identity",loading:"none"}).then(function(t){t.phone&&t.username?(e.payForm.username=t.username,e.payForm.phone=t.phone,e.payFormDialog="payFormDialog"):e.payFormDialog="payFormDialog"})):this.authorityDialog="DialogModal2"},saveAsDefault:function(){var e=this;this.isSaveAsDefault=!this.isSaveAsDefault,this.isSaveAsDefault?(t.setStorageSync("payForm",!0),this.$http({url:"/user/complete",method:"PUT",data:{username:this.payForm.username,phone:1*this.payForm.phone},loading:"none"}).catch(function(t){e.isSaveAsDefault=!e.isSaveAsDefault})):t.setStorageSync("payForm",!1)},pay:function(e){if(this.payForm.phone&&this.payForm.username){var i=this;this.payForm.item_id=this.form.item_id,this.$store.state.extra&&(this.payForm.extra=this.$store.state.extra.split("&")[1]),this.buildinParams.order_id?this.$http({url:"/order/"+this.buildinParams.order_id,method:"PUT"}).then(function(t){n(t)}):this.$http({url:"/order",method:"POST",data:this.payForm,loading:"none"}).then(function(t){n(t)})}else t.showModal({title:"提示",content:"请完善信息，以方便我们与您联系",showCancel:!1,confirmText:"知道了"});function n(e){t.requestPayment({provider:"wxpay",timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(n){i.payFormDialog=null,i.$http({url:"/order/"+e.out_trade_no+"/message",v3:!0,loading:"none"}).then(function(e){t.navigateTo({url:"./pay-success"})}).catch(function(e){t.navigateTo({url:"./pay-success"})})}})}},share:function(e){var i=this;this.ifPosterInfo=!0,this.$http({url:"/item/"+this.form.item_id+"/share",loading:"none"}).then(function(n){i.extra=n.extra,i.$store.commit("qrSrc",n.url),i.tempTarget=e.currentTarget.dataset.target,i.modalName=i.tempTarget,i.$refs.child.OnCanvas(),setTimeout(function(){t.showLoading({title:"海报生成中",mask:!0})},100)})},getPosterInfo:function(t){this.tempFilePath=t.tempFilePath},hideLoading:function(){t.hideLoading()},save:function(){t.saveImageToPhotosAlbum({filePath:this.tempFilePath,success:function(){t.showToast({title:"海报已保存到相册，可分享给好友",icon:"none",duration:2500})}})},shareTo:function(){var e=this;setTimeout(function(){t.previewImage({urls:[e.tempFilePath],longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(t){},fail:function(t){}}})})},favorite:function(){var t=this;this.favoriteActive?this.$http({url:"/collection/item/"+this.form.item_id,method:"DELETE",loading:"none"}).then(function(e){t.favoriteActive=""}):this.$http({url:"/collection/item",method:"POST",data:{item_id:this.form.item_id},loading:"none"}).then(function(e){t.favoriteActive="color: palevioletred"})},home:function(){t.reLaunch({url:"../index/index"})},toInstitution:function(){t.navigateTo({url:"./institution-normal?id=".concat(this.form.institution_id)})},cancelAuth:function(){this.authorityDialog=null},previewImage:function(e){this.previewImageUrl=e,t.previewImage({urls:[this.previewImageUrl],longPressActions:{itemList:["发送给朋友","保存图片","收藏"]}})}}};e.default=a}).call(this,i("543d")["default"])},da71:function(t,e,i){"use strict";i.r(e);var n=i("8943"),o=i("3c0c");for(var a in o)"default"!==a&&function(t){i.d(e,t,function(){return o[t]})}(a);i("b442");var r=i("2877"),s=Object(r["a"])(o["default"],n["a"],n["b"],!1,null,null,null);e["default"]=s.exports}},[["7923","common/runtime","common/vendor"]]]);